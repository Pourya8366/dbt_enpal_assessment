version: 2

models:
  - name: stg_activity_types
    description: List of activity types
    columns:
      - name: id
        description: unique identifier for a project (UUID)
        tests:
          - not_null
          - unique
      - name: activity_name
        description: There are only 3 options for purchasing
        tests:
          - accepted_values:
              values: ['Sales Call 1','Sales Call 2','Follow Up Call', 'After Close Call']
      - name: error_type
        tests:
          - accepted_values:
              values: ['auth','config','other','not_connected']
      - name: error_date
        tests:
          - not_null
  - name: fct_project
    description: detailed project records
    columns:
      - name: id
        description: unique identifier for a project (UUID)
        tests:
          - not_null
          - unique
      - name: project_number
        description: unique identifier for a project (Integer)
        tests:
          - not_null
          - unique
      - name: is_abandoned
        description: flag that shows if the project is abandoned or not
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: is_eoc
        description: flag that shows if the project is created after EOC activation date in the respective market
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: is_bookable
        description: flag that shows if the project is bookable or not
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: bookable_at
        description: The date that project got bookable
      - name: abandoned_at
        description: The date that project got abandoned
      - name: last_pricespec_id
        description: The Last price spec that the project is related to
      - name: last_pricespec_has_pv
        description: flag that shows if the last price spec has PV system
      - name: last_pricespec_has_battery
        description: flag that shows if the last price spec has Battery
      - name: last_pricespec_has_ev_charger
        description: flag that shows if the last price spec has EV Charger
      - name: last_pricespec_panel_type_label,
        description: Panel type of the last price spec
      - name: flagging_reason
        description: The possible current flagging reason
      - name: reason_for_reschedule
        description: The possible reason for rescheduling the installation
      - name: days_in_current_station
        description: The number of days that the project is in the current workstation
      - name: location_address_id
        description: The location address that the project is located in
      - name: agent_id
        description: The agent that the project is assigned to
      - name: agent_fullname
        description: The agent's fullname that the project is assigned to
      - name: customer_id
        description: The customer that the project is belong to
      - name: customer_photos_completed
        description: flag that shows if all the photos required from customer is uploaded and verified successfully
      - name: installer_id
        description: The installer that the project is assigned to
      - name: installation_id
        description: The installation instance that the project is related to
      - name: business_unit_id
        description: The business unit that the project is belong to
      - name: last_credit_check_status
        description: The status of the latest credit check for the customer of this project
      - name: workstation_name
        description: The current workstation that project is in
      - name: workstation_ordinal_idx
        description: The numerical order of current workstation that project is in
      - name: grid_owner_id
        description: The grid owner instance that the project is related to
      - name: invoiced_at
        description: The date that the project is invoiced to installer
      - name: installation_end_completed
        description: flag that shows if the project's installation completed
      - name: installation_start_completed
        description: flag that shows if the project's installation started
      - name: interest_id
        description: The interest that the project is initiated from
      - name: last_accepted_contract_purchase_model
        description: The purchase model of the project according to latest accepted contract
      - name: abandon_reason_label
        description: The reason of the abandonment of the project
      - name: construction_date_set
        description: The time that the construction date has been set, the construction set date is the soonest set date between panel installation date, electrician visit date and inverter installation date
      - name: construction_date_at
        description: The time of the construction, the construction date is the soonest date between panel installation date, electrician visit date and inverter installation date
  - name: dim_project_agent
    description: The collection of project agents info
    columns:
      - name: id
        description: unique identifier for the agent
        tests:
          - not_null
          - unique
      - name: project_id
        tests:
          - not_null
      - name: user_id
        tests:
          - not_null
  - name: fct_credit_check
    description: The collection of project's credit check records
    columns:
      - name: id
        description: unique identifier for a credit check record
        tests:
          - not_null
          - unique
  - name: fct_project_app_users
    description: The collection of customer app auth logs for projects
    columns:
      - name: project_id
        description: unique identifier for a credit check record
        tests:
          - not_null
      - name: app_user_signed_in_at_date
        description: user signed in date
        tests:
          - not_null
      - name: signed_in_ordinal_num
        description: ordinal number based on signed in date for each project
        tests:
          - not_null
  - name: fct_project_savings
    description: The collection of project's savings records
    columns:
      - name: id
        description: unique identifier for a credit check record
        tests:
          - not_null
          - unique
      - name: project_id
        description: unique identifier for the project
        tests:
          - not_null
          - unique
      - name: price_spec_id
        description: unique identifier for the project
        tests:
          - not_null
          - unique
  - name: fct_project_financial_report
    description: The collection of project's financial fields
    columns:
      - name: id
        description: unique identifier for the financial record
        tests:
          - not_null
          - unique
      - name: project_id
        description: unique identifier for the project
        tests:
          - not_null
          - unique
  - name: fct_project_milestone
    description: The collection of project's milestone dates
    columns:
      - name: project_id
        description: unique identifier for the project
        tests:
          - not_null
          - unique
  - name: fct_project_forecast_report
    description: A collection of forecasts on projects cost
    columns:
      - name: id
        tests:
          - not_null
          - unique
      - name: project_id
        tests:
          - not_null
          - unique
      - name: assigned_installer_cost_loc
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: assigned_installer_cost_eur
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: cost_now_loc
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: cost_now_eur
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: price_at_first_sale_loc
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: price_at_first_sale_eur
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: price_now_loc
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: price_now_eur
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: second_lowest_cost_loc
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: second_lowest_cost_eur
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: num_panels
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: num_performance_panels
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: num_premium_panels
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: num_standard_panels
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: num_optimizers
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
      - name: optimizers_at_first_sale
        tests:
          - dbt_utils.expression_is_true:
              expression: '::int >= 0'
  - name: fct_project_events
    description: The collection of project's events
    columns:
      - name: id
        description: unique identifier for the event
        tests:
          - not_null
      - name: project_id
        description: identifier for the project
        tests:
          - not_null
  - name: fct_project_rolling_sales
    description: The collection of project rolling sums based on sales date
    columns:
      - name: created_date
        description: project creation date
        tests:
          - not_null
      - name: country_name
        description: project location country
        tests:
          - not_null
          - accepted_values:
              values: ['Norway','Sweden','Spain','Poland','Italy','France','Germany','United Kingdom','Austria','Portugal','Netherlands','Belgium','Switzerland', 'Brazil']
      - name: is_otovo
        description: Is country part of Otovo Markets
        tests:
          - not_null
          - accepted_values:
              values: [true,false]
  - name: fct_project_rolling_abandons
    description: The collection of project rolling sums based on abandon date
    columns:
      - name: abandon_date
        description: project abandonment date
        tests:
          - not_null
      - name: country_name
        description: project location country
        tests:
          - not_null
          - accepted_values:
              values: ['Norway','Sweden','Spain','Poland','Italy','France','Germany','United Kingdom','Austria','Portugal','Netherlands','Belgium','Switzerland', 'Brazil']
      - name: is_otovo
        description: Is country part of Otovo Markets
        tests:
          - not_null
          - accepted_values:
              values: [true,false]
  - name: fct_project_rolling_bookables
    description: The collection of project rolling sums based on bookable date
    columns:
      - name: bookable_date
        description: project bookable date
        tests:
          - not_null
      - name: country_name
        description: project location country
        tests:
          - not_null
          - accepted_values:
              values: ['Norway','Sweden','Spain','Poland','Italy','France','Germany','United Kingdom','Austria','Portugal','Netherlands','Belgium','Switzerland', 'Brazil']
      - name: is_otovo
        description: Is country part of Otovo Markets
        tests:
          - not_null
          - accepted_values:
              values: [true,false]
  - name: fct_project_estimated_installation_date
    description: The collection of project estimated installation dates
    columns:
      - name: project_id
        description: unique project ID
        tests:
          - not_null
          - unique
      - name: country_code
        description: Country of the project
        tests:
          - not_null
          - accepted_values:
              values: ['be','fr','ch','se','no','es','pt','it','nl','at','gb','de','pl']
      - name: workstation
        description: currenct workstation of project
        tests:
          - not_null
          - accepted_values:
              values: ['qualification', 'feasibility', 'assigning', 'engineering', 'permitting', 'scheduling', 'pending_installation']
      - name: workstation_ordinal_idx
        description: currenct workstation index of project
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 7]
  - name: fct_project_backlog
    description: The collection of project backlog sums based on created date
    columns:
      - name: created_date
        description: project created date
        tests:
          - not_null
      - name: country_name
        description: project location country
        tests:
          - not_null
          - accepted_values:
              values: ['Norway','Sweden','Spain','Poland','Italy','France','Germany','United Kingdom','Austria','Portugal','Netherlands','Belgium','Switzerland', 'Brazil']
      - name: is_otovo
        description: Is country part of Otovo Markets
        tests:
          - not_null
          - accepted_values:
              values: [true,false]
  - name: fct_all_projects_list
    description: The collection of projects information
    columns:
      - name: project_id
        description: project Unique ID
        tests:
          - not_null
          - unique
      - name: country_code
        description: Country of the project
        tests:
          - not_null
          - accepted_values:
              values: ['be','fr','ch','se','no','es','pt','it','nl','at','gb','de','pl', 'br']
  - name: fct_project_abandons
    description: The collection of projects information
    columns:
      - name: project_id
        description: project Unique ID
        tests:
          - not_null
      - name: event_date
        description: the date of sale or abandon
        tests:
          - not_null
      - name: event_type
        description: the type of the event
        tests:
          - not_null
          - accepted_values:
              values: ['Sale','Abandon']
  - name: fct_project_change_events
    description: The collection of events for project change
    columns:
      - name: id
        description: unique identifier for an event
        tests:
          - not_null
      - name: is_performed_in_app
        description: The flag that indicated if this event emitted from installer app
      - name: project_id
        description: The project that this event emitted for
        tests:
          - not_null
      - name: created_by_user_id
        description: The auth user that created this event
  - name: fct_project_reconcilliation
    description: The collection of reconcilliation report for projects
    columns:
      - name: project_id
        description: unique identifier for a project
        tests:
          - not_null
          - unique
      - name: business_unit_id
        description: The business unit ID
        tests:
          - not_null
      - name: id
        description: The reconcilliation ID
        tests:
          - not_null
          - unique
